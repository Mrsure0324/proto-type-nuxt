import{e as ee,s as U,r as te,a3 as le,c as u,a as l,b as o,w as g,L as j,d as x,t as L,F as D,y as se,a2 as E,O as oe,V as ae,W as ie,S as ne,P as de,U as ue,a0 as re,o as r,Z as ve,i as B,a4 as N,T as me,n as pe}from"./BjynnqB9.js";import{_ as ce}from"./DlAUqK2U.js";const fe={class:"page"},ge={class:"panel"},xe={class:"left"},we={class:"form"},_e={class:"form-item"},Ve={class:"form-item"},ye={class:"form-item"},ke={class:"form-item two-col"},be={class:"label"},Me={key:0,class:"hint-text"},ze={key:1,class:"hint-text"},he={class:"hint"},Ue={class:"form-item two-col"},Le={class:"label"},Ee={key:0,class:"hint-text"},Re={key:1,class:"hint-text"},Se={class:"label"},Ce={key:0,class:"hint-text"},Xe={key:1,class:"hint-text"},Ye={class:"form-item two-col"},Oe={class:"form-item two-col"},Ie={class:"label"},Pe={key:0,class:"hint-text"},je={key:1,class:"hint-text"},De={class:"label"},Te={key:0,class:"hint-text"},$e={key:1,class:"hint-text"},Be={class:"form-item two-col"},Ne={class:"form-item"},We={class:"form-item"},Ae={key:2,class:"export-size"},Fe={class:"actions"},Ge={class:"right"},He={class:"preview"},Je={key:0,class:"preview-img"},Ke=["src"],Ze={key:0,class:"preview-nav"},qe={class:"preview-counter"},Qe={key:1,class:"placeholder"},et={key:0,class:"list"},tt={class:"list-title"},lt={class:"list-items"},st=["onClick"],ot={class:"name"},at=ee({__name:"index",setup(it){const m=U([]),C=U(!1),T=U(!1),M=U(null),w=U(0),f=U({}),t=te({text:"像素潮汐  |  PIXEL TIDE  |  DESIGN STUDIO",fontSize:2,sizeMode:"relative",color:"#ffffff",opacity:.6,angle:-30,gapX:220,gapY:130,tile:!1,offsetX:0,offsetY:-3,outputScale:2,limit1080p:!0}),y=U(""),W=a=>{const e=a.raw;if(!e)return;const v=URL.createObjectURL(e);m.value=[{name:e.name,url:v,raw:e}],y.value="",w.value=0,f.value={},X()},A=a=>{m.value=a.map(e=>({name:e.name,url:URL.createObjectURL(e.raw),raw:e.raw})),y.value="",w.value=0,f.value={},X()},F=a=>new Promise((e,v)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>e(i),i.onerror=k=>v(k),i.src=URL.createObjectURL(a)}),$=async a=>{const e=await F(a),v=e.naturalWidth,i=e.naturalHeight,k=t.outputScale||1,z=t.limit1080p?Math.min(1920/v,1080/i,1):1,_=Math.max(k*z,.05),c=Math.max(1,Math.round(v*_)),n=Math.max(1,Math.round(i*_)),h=document.createElement("canvas");h.width=c,h.height=n;const d=h.getContext("2d");if(!d)throw new Error("Canvas not supported");d.drawImage(e,0,0,c,n),d.save(),d.globalAlpha=t.opacity,d.fillStyle=t.color;let s;if(t.sizeMode==="relative"){const p=Math.max(c,n);s=t.fontSize/100*p}else s=t.fontSize*_;if(d.font=`${s}px sans-serif`,d.textAlign="center",d.textBaseline="middle",t.tile){d.translate(c/2,n/2),d.rotate(t.angle*Math.PI/180),d.translate(-c/2,-n/2);let p,V;if(t.sizeMode==="relative"){const R=Math.max(c,n);p=t.gapX/100*R,V=t.gapY/100*R}else p=t.gapX*_,V=t.gapY*_;const b=-c,Y=c*2,O=-n,I=n*2;for(let R=b;R<=Y;R+=p)for(let P=O;P<=I;P+=V)d.fillText(t.text,R,P)}else{let p,V,b;if(t.sizeMode==="relative"){const I=Math.max(c,n);p=3/100*I,V=t.offsetX/100*c,b=t.offsetY/100*n}else p=60*_,V=t.offsetX*_,b=t.offsetY*_;const Y=c/2+V,O=n-p+b;d.fillText(t.text,Y,O)}return d.restore(),new Promise((p,V)=>{h.toBlob(b=>{if(!b)return V(new Error("导出失败"));p({blob:b,width:c,height:n})},"image/png")})},G=(a,e=300)=>{let v;return(...i)=>{clearTimeout(v),v=setTimeout(()=>a(...i),e)}},S=async()=>{if(!m.value.length){y.value="",M.value=null;return}T.value=!0;try{const a=m.value[w.value]||m.value[0],e=`${a.name}_${JSON.stringify(t)}`;if(f.value[e])y.value=f.value[e].url,M.value={w:f.value[e].width,h:f.value[e].height};else{const{blob:v,width:i,height:k}=await $(a.raw),z=URL.createObjectURL(v);f.value[e]={url:z,width:i,height:k},y.value=z,M.value={w:i,h:k},Z()}}catch(a){console.error(a),E.error("预览生成失败")}finally{T.value=!1}},X=G(S,300),H=(a,e)=>{const v=URL.createObjectURL(a),i=document.createElement("a");i.href=v,i.download=e.endsWith(".png")?e:`${e}.png`,i.click(),URL.revokeObjectURL(v)},J=async()=>{if(!m.value.length)return E.warning("请先上传图片");await S(),E.success("预览生成完成")},K=()=>{for(const a in f.value)URL.revokeObjectURL(f.value[a].url);f.value={}},Z=(a=10)=>{const e=Object.keys(f.value);e.length>a&&e.slice(0,e.length-a).forEach(i=>{URL.revokeObjectURL(f.value[i].url),delete f.value[i]})},q=()=>{m.value=[],y.value="",M.value=null,K(),w.value=0,E.success("已清空图片")};le(()=>({...t}),()=>X(),{deep:!0});const Q=async()=>{if(!m.value.length)return E.warning("请先上传图片");C.value=!0;try{for(const a of m.value){const{blob:e}=await $(a.raw);H(e,`watermark-${a.name}`)}E.success("批量导出完成")}catch(a){console.error(a),E.error("导出失败")}finally{C.value=!1}};return(a,e)=>{const v=ve,i=oe,k=ae,z=ie,_=me,c=ne,n=de,h=ue,d=re;return r(),u("div",fe,[l("div",ge,[l("div",xe,[e[40]||(e[40]=l("div",{class:"section-title"},"上传图片",-1)),o(i,{class:"upload-block",drag:"","auto-upload":!1,"show-file-list":!1,accept:"image/*",limit:1,"on-change":W},{default:g(()=>[o(v,{class:"el-icon--upload"},{default:g(()=>[o(B(N))]),_:1}),e[17]||(e[17]=l("div",{class:"el-upload__text"},"拖拽或点击上传单张预览",-1))]),_:1}),e[41]||(e[41]=l("div",{class:"section-title"},"批量上传",-1)),o(i,{class:"upload-block",drag:"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:"image/*","on-change":(s,p)=>A(p)},{default:g(()=>[o(v,{class:"el-icon--upload"},{default:g(()=>[o(B(N))]),_:1}),e[18]||(e[18]=l("div",{class:"el-upload__text"},"拖拽或点击上传多张图片",-1))]),_:1},8,["on-change"]),e[42]||(e[42]=l("div",{class:"section-title"},"水印设置",-1)),l("div",we,[l("div",_e,[e[19]||(e[19]=l("div",{class:"label"},"文本",-1)),o(k,{modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=s=>t.text=s),placeholder:"请输入水印文本"},null,8,["modelValue"])]),l("div",Ve,[e[20]||(e[20]=l("div",{class:"label"},"模式",-1)),o(z,{modelValue:t.tile,"onUpdate:modelValue":e[1]||(e[1]=s=>t.tile=s),"active-text":"平铺","inactive-text":"单行"},null,8,["modelValue"])]),l("div",ye,[e[23]||(e[23]=l("div",{class:"label"},"大小模式",-1)),o(c,{modelValue:t.sizeMode,"onUpdate:modelValue":e[2]||(e[2]=s=>t.sizeMode=s)},{default:g(()=>[o(_,{label:"absolute"},{default:g(()=>[...e[21]||(e[21]=[x("绝对像素",-1)])]),_:1}),o(_,{label:"relative"},{default:g(()=>[...e[22]||(e[22]=[x("相对图片大小",-1)])]),_:1})]),_:1},8,["modelValue"])]),l("div",ke,[l("div",null,[l("div",be,[e[24]||(e[24]=x(" 字号 ",-1)),t.sizeMode==="relative"?(r(),u("span",Me,"(%)")):(r(),u("span",ze,"(px)"))]),o(n,{modelValue:t.fontSize,"onUpdate:modelValue":e[3]||(e[3]=s=>t.fontSize=s),min:t.sizeMode==="relative"?.1:10,max:t.sizeMode==="relative"?10:200,step:t.sizeMode==="relative"?.1:1},null,8,["modelValue","min","max","step"]),l("div",he,L(t.sizeMode==="relative"?"相对于图片最大边长的百分比":"固定像素大小"),1)]),l("div",null,[e[25]||(e[25]=l("div",{class:"label"},"透明度",-1)),o(n,{modelValue:t.opacity,"onUpdate:modelValue":e[4]||(e[4]=s=>t.opacity=s),min:.05,max:1,step:.05},null,8,["modelValue"])])]),t.tile?(r(),u(D,{key:0},[l("div",Ue,[l("div",null,[l("div",Le,[e[26]||(e[26]=x(" 间距 X ",-1)),t.sizeMode==="relative"?(r(),u("span",Ee,"(%)")):(r(),u("span",Re,"(px)"))]),o(n,{modelValue:t.gapX,"onUpdate:modelValue":e[5]||(e[5]=s=>t.gapX=s),min:t.sizeMode==="relative"?1:40,max:t.sizeMode==="relative"?50:800,step:t.sizeMode==="relative"?.5:10},null,8,["modelValue","min","max","step"])]),l("div",null,[l("div",Se,[e[27]||(e[27]=x(" 间距 Y ",-1)),t.sizeMode==="relative"?(r(),u("span",Ce,"(%)")):(r(),u("span",Xe,"(px)"))]),o(n,{modelValue:t.gapY,"onUpdate:modelValue":e[6]||(e[6]=s=>t.gapY=s),min:t.sizeMode==="relative"?1:40,max:t.sizeMode==="relative"?50:800,step:t.sizeMode==="relative"?.5:10},null,8,["modelValue","min","max","step"])])]),l("div",Ye,[l("div",null,[e[28]||(e[28]=l("div",{class:"label"},"角度",-1)),o(n,{modelValue:t.angle,"onUpdate:modelValue":e[7]||(e[7]=s=>t.angle=s),min:-180,max:180},null,8,["modelValue"])]),l("div",null,[e[29]||(e[29]=l("div",{class:"label"},"颜色",-1)),o(h,{modelValue:t.color,"onUpdate:modelValue":e[8]||(e[8]=s=>t.color=s),"show-alpha":""},null,8,["modelValue"])])])],64)):(r(),u(D,{key:1},[l("div",Oe,[l("div",null,[l("div",Ie,[e[30]||(e[30]=x(" 偏移 X ",-1)),t.sizeMode==="relative"?(r(),u("span",Pe,"(%)")):(r(),u("span",je,"(px)"))]),o(n,{modelValue:t.offsetX,"onUpdate:modelValue":e[9]||(e[9]=s=>t.offsetX=s),min:t.sizeMode==="relative"?-50:-800,max:t.sizeMode==="relative"?50:800,step:t.sizeMode==="relative"?1:10},null,8,["modelValue","min","max","step"])]),l("div",null,[l("div",De,[e[31]||(e[31]=x(" 偏移 Y ",-1)),t.sizeMode==="relative"?(r(),u("span",Te,"(%)")):(r(),u("span",$e,"(px)"))]),o(n,{modelValue:t.offsetY,"onUpdate:modelValue":e[10]||(e[10]=s=>t.offsetY=s),min:t.sizeMode==="relative"?-50:-800,max:t.sizeMode==="relative"?50:800,step:t.sizeMode==="relative"?1:10},null,8,["modelValue","min","max","step"])])]),l("div",Be,[l("div",null,[e[32]||(e[32]=l("div",{class:"label"},"颜色",-1)),o(h,{modelValue:t.color,"onUpdate:modelValue":e[11]||(e[11]=s=>t.color=s),"show-alpha":""},null,8,["modelValue"])]),l("div",null,[e[33]||(e[33]=l("div",{class:"label"},"角度（单行不旋转，保留设置用于切换平铺）",-1)),o(n,{modelValue:t.angle,"onUpdate:modelValue":e[12]||(e[12]=s=>t.angle=s),min:-90,max:90},null,8,["modelValue"])])])],64)),e[36]||(e[36]=l("div",{class:"section-title export-title"},"导出设置",-1)),l("div",Ne,[e[34]||(e[34]=l("div",{class:"label"},"缩放倍数（相对原图）",-1)),o(n,{modelValue:t.outputScale,"onUpdate:modelValue":e[13]||(e[13]=s=>t.outputScale=s),min:.1,max:3,step:.05},null,8,["modelValue"])]),l("div",We,[o(z,{modelValue:t.limit1080p,"onUpdate:modelValue":e[14]||(e[14]=s=>t.limit1080p=s),"active-text":"限制在 1080p 以内","inactive-text":"不限制"},null,8,["modelValue"]),e[35]||(e[35]=l("div",{class:"hint"},"开启后会按最长边不超过 1080p（约 1920×1080）再乘以缩放倍数",-1))]),M.value?(r(),u("div",Ae," 导出分辨率："+L(M.value.w)+" × "+L(M.value.h),1)):j("",!0)]),l("div",Fe,[o(d,{type:"primary",loading:C.value,onClick:J},{default:g(()=>[...e[37]||(e[37]=[x("生成预览",-1)])]),_:1},8,["loading"]),o(d,{type:"success",loading:C.value,onClick:Q},{default:g(()=>[...e[38]||(e[38]=[x("批量导出",-1)])]),_:1},8,["loading"]),o(d,{type:"warning",plain:"",onClick:q},{default:g(()=>[...e[39]||(e[39]=[x("清空图片",-1)])]),_:1})])]),l("div",Ge,[e[45]||(e[45]=l("div",{class:"section-title"},"预览",-1)),l("div",He,[y.value?(r(),u("div",Je,[l("img",{src:y.value,alt:"preview"},null,8,Ke),m.value.length>1?(r(),u("div",Ze,[o(d,{size:"small",onClick:e[15]||(e[15]=s=>{w.value=(w.value-1+m.value.length)%m.value.length,S()})},{default:g(()=>[...e[43]||(e[43]=[x(" 上一张 ",-1)])]),_:1}),l("div",qe,L(w.value+1)+" / "+L(m.value.length),1),o(d,{size:"small",onClick:e[16]||(e[16]=s=>{w.value=(w.value+1)%m.value.length,S()})},{default:g(()=>[...e[44]||(e[44]=[x(" 下一张 ",-1)])]),_:1})])):j("",!0)])):(r(),u("div",Qe,"请上传图片并点击生成预览"))]),m.value.length>0?(r(),u("div",et,[l("div",tt,"已选文件（"+L(m.value.length)+"）",1),l("div",lt,[(r(!0),u(D,null,se(m.value,(s,p)=>(r(),u("div",{key:s.url,class:pe(["file-item",{active:p===w.value}]),onClick:V=>{w.value=p,S()}},[l("div",ot,L(s.name),1)],10,st))),128))])])):j("",!0)])])])}}}),ut=ce(at,[["__scopeId","data-v-c44080d9"]]);export{ut as default};
