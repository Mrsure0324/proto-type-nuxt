import{e as J,s as U,r as Q,a3 as ee,c,a as l,b as a,w as g,L as M,F as O,t as E,y as le,a2 as k,O as te,V as oe,W as ae,P as se,U as ne,a0 as ie,o as f,Z as de,i as T,a4 as j,d as X,n as ue}from"./CI3uJhRJ.js";import{_ as re}from"./DlAUqK2U.js";const me={class:"page"},ve={class:"panel"},pe={class:"left"},ce={class:"form"},fe={class:"form-item"},ge={class:"form-item"},we={class:"form-item two-col"},Ve={class:"form-item two-col"},xe={class:"form-item two-col"},be={class:"form-item two-col"},ye={class:"form-item two-col"},Ue={class:"form-item"},ke={class:"form-item"},_e={key:2,class:"export-size"},Ee={class:"actions"},Le={class:"right"},Se={class:"preview"},Ce={key:0,class:"preview-img"},Xe=["src"],Ye={key:0,class:"preview-nav"},Ie={class:"preview-counter"},Re={key:1,class:"placeholder"},ze={key:0,class:"list"},Me={class:"list-title"},Oe={class:"list-items"},Pe=["onClick"],he={class:"name"},Be=J({__name:"index",setup(Te){const u=U([]),Y=U(!1),P=U(!1),b=U(null),v=U(0),w=U({}),t=Q({text:"像素潮汐  |  PIXEL TIDE  |  DESIGN STUDIO",fontSize:100,color:"#ffffff",opacity:.6,angle:-30,gapX:220,gapY:130,tile:!1,offsetX:0,offsetY:-250,outputScale:2,limit1080p:!0}),V=U(""),$=s=>{const e=s.raw;if(!e)return;const r=URL.createObjectURL(e);u.value=[{name:e.name,url:r,raw:e}],V.value="",v.value=0,w.value={},I()},D=s=>{u.value=s.map(e=>({name:e.name,url:URL.createObjectURL(e.raw),raw:e.raw})),V.value="",v.value=0,w.value={},I()},N=s=>new Promise((e,r)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>e(n),n.onerror=x=>r(x),n.src=URL.createObjectURL(s)}),h=async s=>{const e=await N(s),r=e.naturalWidth,n=e.naturalHeight,x=t.outputScale||1,y=t.limit1080p?Math.min(1920/r,1080/n,1):1,d=Math.max(x*y,.05),p=Math.max(1,Math.round(r*d)),m=Math.max(1,Math.round(n*d)),o=document.createElement("canvas");o.width=p,o.height=m;const i=o.getContext("2d");if(!i)throw new Error("Canvas not supported");i.drawImage(e,0,0,p,m),i.save(),i.globalAlpha=t.opacity,i.fillStyle=t.color;const B=t.fontSize*d;if(i.font=`${B}px sans-serif`,i.textAlign="center",i.textBaseline="middle",t.tile){i.translate(p/2,m/2),i.rotate(t.angle*Math.PI/180),i.translate(-p/2,-m/2);const S=t.gapX*d,C=t.gapY*d,_=-p,K=p*2,Z=-m,q=m*2;for(let R=_;R<=K;R+=S)for(let z=Z;z<=q;z+=C)i.fillText(t.text,R,z)}else{const S=60*d,C=p/2+t.offsetX*d,_=m-S+t.offsetY*d;i.fillText(t.text,C,_)}return i.restore(),new Promise((S,C)=>{o.toBlob(_=>{if(!_)return C(new Error("导出失败"));S({blob:_,width:p,height:m})},"image/png")})},W=(s,e=300)=>{let r;return(...n)=>{clearTimeout(r),r=setTimeout(()=>s(...n),e)}},L=async()=>{if(!u.value.length){V.value="",b.value=null;return}P.value=!0;try{const s=u.value[v.value]||u.value[0],e=s.name;if(w.value[e])V.value=w.value[e].url,b.value={w:w.value[e].width,h:w.value[e].height};else{const{blob:r,width:n,height:x}=await h(s.raw),y=URL.createObjectURL(r);w.value[e]={url:y,width:n,height:x},V.value=y,b.value={w:n,h:x}}}catch(s){console.error(s),k.error("预览生成失败")}finally{P.value=!1}},I=W(L,300),A=(s,e)=>{const r=URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=e.endsWith(".png")?e:`${e}.png`,n.click(),URL.revokeObjectURL(r)},F=async()=>{if(!u.value.length)return k.warning("请先上传图片");await L(),k.success("预览生成完成")},H=()=>{u.value=[],V.value="",b.value=null,w.value={},v.value=0,k.success("已清空图片")};ee(()=>({...t}),()=>I(),{deep:!0});const G=async()=>{if(!u.value.length)return k.warning("请先上传图片");Y.value=!0;try{for(const s of u.value){const{blob:e}=await h(s.raw);A(e,`watermark-${s.name}`)}k.success("批量导出完成")}catch(s){console.error(s),k.error("导出失败")}finally{Y.value=!1}};return(s,e)=>{const r=de,n=te,x=oe,y=ae,d=se,p=ne,m=ie;return f(),c("div",me,[l("div",ve,[l("div",pe,[e[36]||(e[36]=l("div",{class:"section-title"},"上传图片",-1)),a(n,{class:"upload-block",drag:"","auto-upload":!1,"show-file-list":!1,accept:"image/*",limit:1,"on-change":$},{default:g(()=>[a(r,{class:"el-icon--upload"},{default:g(()=>[a(T(j))]),_:1}),e[16]||(e[16]=l("div",{class:"el-upload__text"},"拖拽或点击上传单张预览",-1))]),_:1}),e[37]||(e[37]=l("div",{class:"section-title"},"批量上传",-1)),a(n,{class:"upload-block",drag:"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:"image/*","on-change":(o,i)=>D(i)},{default:g(()=>[a(r,{class:"el-icon--upload"},{default:g(()=>[a(T(j))]),_:1}),e[17]||(e[17]=l("div",{class:"el-upload__text"},"拖拽或点击上传多张图片",-1))]),_:1},8,["on-change"]),e[38]||(e[38]=l("div",{class:"section-title"},"水印设置",-1)),l("div",ce,[l("div",fe,[e[18]||(e[18]=l("div",{class:"label"},"文本",-1)),a(x,{modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=o=>t.text=o),placeholder:"请输入水印文本"},null,8,["modelValue"])]),l("div",ge,[e[19]||(e[19]=l("div",{class:"label"},"模式",-1)),a(y,{modelValue:t.tile,"onUpdate:modelValue":e[1]||(e[1]=o=>t.tile=o),"active-text":"平铺","inactive-text":"单行"},null,8,["modelValue"])]),l("div",we,[l("div",null,[e[20]||(e[20]=l("div",{class:"label"},"字号",-1)),a(d,{modelValue:t.fontSize,"onUpdate:modelValue":e[2]||(e[2]=o=>t.fontSize=o),min:10,max:200},null,8,["modelValue"])]),l("div",null,[e[21]||(e[21]=l("div",{class:"label"},"透明度",-1)),a(d,{modelValue:t.opacity,"onUpdate:modelValue":e[3]||(e[3]=o=>t.opacity=o),min:.05,max:1,step:.05},null,8,["modelValue"])])]),t.tile?(f(),c(O,{key:0},[l("div",Ve,[l("div",null,[e[22]||(e[22]=l("div",{class:"label"},"间距 X",-1)),a(d,{modelValue:t.gapX,"onUpdate:modelValue":e[4]||(e[4]=o=>t.gapX=o),min:40,max:800},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("div",{class:"label"},"间距 Y",-1)),a(d,{modelValue:t.gapY,"onUpdate:modelValue":e[5]||(e[5]=o=>t.gapY=o),min:40,max:800},null,8,["modelValue"])])]),l("div",xe,[l("div",null,[e[24]||(e[24]=l("div",{class:"label"},"角度",-1)),a(d,{modelValue:t.angle,"onUpdate:modelValue":e[6]||(e[6]=o=>t.angle=o),min:-180,max:180},null,8,["modelValue"])]),l("div",null,[e[25]||(e[25]=l("div",{class:"label"},"颜色",-1)),a(p,{modelValue:t.color,"onUpdate:modelValue":e[7]||(e[7]=o=>t.color=o),"show-alpha":""},null,8,["modelValue"])])])],64)):(f(),c(O,{key:1},[l("div",be,[l("div",null,[e[26]||(e[26]=l("div",{class:"label"},"偏移 X",-1)),a(d,{modelValue:t.offsetX,"onUpdate:modelValue":e[8]||(e[8]=o=>t.offsetX=o),min:-800,max:800},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("div",{class:"label"},"偏移 Y",-1)),a(d,{modelValue:t.offsetY,"onUpdate:modelValue":e[9]||(e[9]=o=>t.offsetY=o),min:-800,max:800},null,8,["modelValue"])])]),l("div",ye,[l("div",null,[e[28]||(e[28]=l("div",{class:"label"},"颜色",-1)),a(p,{modelValue:t.color,"onUpdate:modelValue":e[10]||(e[10]=o=>t.color=o),"show-alpha":""},null,8,["modelValue"])]),l("div",null,[e[29]||(e[29]=l("div",{class:"label"},"角度（单行不旋转，保留设置用于切换平铺）",-1)),a(d,{modelValue:t.angle,"onUpdate:modelValue":e[11]||(e[11]=o=>t.angle=o),min:-90,max:90},null,8,["modelValue"])])])],64)),e[32]||(e[32]=l("div",{class:"section-title export-title"},"导出设置",-1)),l("div",Ue,[e[30]||(e[30]=l("div",{class:"label"},"缩放倍数（相对原图）",-1)),a(d,{modelValue:t.outputScale,"onUpdate:modelValue":e[12]||(e[12]=o=>t.outputScale=o),min:.1,max:3,step:.05},null,8,["modelValue"])]),l("div",ke,[a(y,{modelValue:t.limit1080p,"onUpdate:modelValue":e[13]||(e[13]=o=>t.limit1080p=o),"active-text":"限制在 1080p 以内","inactive-text":"不限制"},null,8,["modelValue"]),e[31]||(e[31]=l("div",{class:"hint"},"开启后会按最长边不超过 1080p（约 1920×1080）再乘以缩放倍数",-1))]),b.value?(f(),c("div",_e," 导出分辨率："+E(b.value.w)+" × "+E(b.value.h),1)):M("",!0)]),l("div",Ee,[a(m,{type:"primary",loading:Y.value,onClick:F},{default:g(()=>[...e[33]||(e[33]=[X("生成预览",-1)])]),_:1},8,["loading"]),a(m,{type:"success",loading:Y.value,onClick:G},{default:g(()=>[...e[34]||(e[34]=[X("批量导出",-1)])]),_:1},8,["loading"]),a(m,{type:"warning",plain:"",onClick:H},{default:g(()=>[...e[35]||(e[35]=[X("清空图片",-1)])]),_:1})])]),l("div",Le,[e[41]||(e[41]=l("div",{class:"section-title"},"预览",-1)),l("div",Se,[V.value?(f(),c("div",Ce,[l("img",{src:V.value,alt:"preview"},null,8,Xe),u.value.length>1?(f(),c("div",Ye,[a(m,{size:"small",onClick:e[14]||(e[14]=o=>{v.value=(v.value-1+u.value.length)%u.value.length,L()})},{default:g(()=>[...e[39]||(e[39]=[X(" 上一张 ",-1)])]),_:1}),l("div",Ie,E(v.value+1)+" / "+E(u.value.length),1),a(m,{size:"small",onClick:e[15]||(e[15]=o=>{v.value=(v.value+1)%u.value.length,L()})},{default:g(()=>[...e[40]||(e[40]=[X(" 下一张 ",-1)])]),_:1})])):M("",!0)])):(f(),c("div",Re,"请上传图片并点击生成预览"))]),u.value.length>0?(f(),c("div",ze,[l("div",Me,"已选文件（"+E(u.value.length)+"）",1),l("div",Oe,[(f(!0),c(O,null,le(u.value,(o,i)=>(f(),c("div",{key:o.url,class:ue(["file-item",{active:i===v.value}]),onClick:B=>{v.value=i,L()}},[l("div",he,E(o.name),1)],10,Pe))),128))])])):M("",!0)])])])}}}),De=re(Be,[["__scopeId","data-v-9d9201fc"]]);export{De as default};
