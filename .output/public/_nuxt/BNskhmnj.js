import{e as Z,s as _,r as q,a3 as J,c,a as l,b as s,w,L as O,F as R,t as L,y as K,O as Q,V as ee,W as le,P as te,U as oe,a0 as se,o as v,Z as ae,i as P,a4 as B,d as T,a2 as V}from"./MQhLVF94.js";import{_ as ne}from"./DlAUqK2U.js";const ie={class:"page"},de={class:"panel"},re={class:"left"},ue={class:"form"},me={class:"form-item"},pe={class:"form-item"},ce={class:"form-item two-col"},ve={class:"form-item two-col"},fe={class:"form-item two-col"},ge={class:"form-item two-col"},we={class:"form-item two-col"},Ve={class:"form-item"},xe={class:"form-item"},be={key:2,class:"export-size"},Ue={class:"actions"},ye={class:"right"},_e={class:"preview"},ke={key:0,class:"preview-img"},Ee=["src"],Le={key:1,class:"placeholder"},Se={key:0,class:"list"},Xe={class:"list-title"},Ye={class:"list-items"},Re={class:"name"},Ie=Z({__name:"index",setup(Ce){const p=_([]),k=_(!1),I=_(!1),x=_(null),t=q({text:"像素潮汐  |  PIXEL TIDE  |  DESIGN STUDIO",fontSize:100,color:"#ffffff",opacity:.6,angle:-30,gapX:220,gapY:130,tile:!1,offsetX:0,offsetY:-250,outputScale:2,limit1080p:!0}),f=_(""),j=a=>{const e=a.raw;if(!e)return;const i=URL.createObjectURL(e);p.value=[{name:e.name,url:i,raw:e}],f.value="",S()},z=a=>{p.value=a.map(e=>({name:e.name,url:URL.createObjectURL(e.raw),raw:e.raw})),f.value="",S()},D=a=>new Promise((e,i)=>{const d=new Image;d.crossOrigin="anonymous",d.onload=()=>e(d),d.onerror=b=>i(b),d.src=URL.createObjectURL(a)}),C=async a=>{const e=await D(a),i=e.naturalWidth,d=e.naturalHeight,b=t.outputScale||1,E=t.limit1080p?Math.min(1920/i,1080/d,1):1,n=Math.max(b*E,.05),u=Math.max(1,Math.round(i*n)),m=Math.max(1,Math.round(d*n)),o=document.createElement("canvas");o.width=u,o.height=m;const r=o.getContext("2d");if(!r)throw new Error("Canvas not supported");r.drawImage(e,0,0,u,m),r.save(),r.globalAlpha=t.opacity,r.fillStyle=t.color;const A=t.fontSize*n;if(r.font=`${A}px sans-serif`,r.textAlign="center",r.textBaseline="middle",t.tile){r.translate(u/2,m/2),r.rotate(t.angle*Math.PI/180),r.translate(-u/2,-m/2);const U=t.gapX*n,y=t.gapY*n,g=-u,F=u*2,H=-m,G=m*2;for(let X=g;X<=F;X+=U)for(let Y=H;Y<=G;Y+=y)r.fillText(t.text,X,Y)}else{const U=60*n,y=u/2+t.offsetX*n,g=m-U+t.offsetY*n;r.fillText(t.text,y,g)}return r.restore(),new Promise((U,y)=>{o.toBlob(g=>{if(!g)return y(new Error("导出失败"));U({blob:g,width:u,height:m})},"image/png")})},N=(a,e=300)=>{let i;return(...d)=>{clearTimeout(i),i=setTimeout(()=>a(...d),e)}},M=async()=>{if(!p.value.length){f.value="",x.value=null;return}I.value=!0;try{const{blob:a,width:e,height:i}=await C(p.value[0].raw);f.value=URL.createObjectURL(a),x.value={w:e,h:i}}catch(a){console.error(a),V.error("预览生成失败")}finally{I.value=!1}},S=N(M,300),W=(a,e)=>{const i=URL.createObjectURL(a),d=document.createElement("a");d.href=i,d.download=e.endsWith(".png")?e:`${e}.png`,d.click(),URL.revokeObjectURL(i)},h=async()=>{if(!p.value.length)return V.warning("请先上传图片");await M(),V.success("预览生成完成")};J(()=>({...t}),()=>S(),{deep:!0});const $=async()=>{if(!p.value.length)return V.warning("请先上传图片");k.value=!0;try{for(const a of p.value){const{blob:e}=await C(a.raw);W(e,`watermark-${a.name}`)}V.success("批量导出完成")}catch(a){console.error(a),V.error("导出失败")}finally{k.value=!1}};return(a,e)=>{const i=ae,d=Q,b=ee,E=le,n=te,u=oe,m=se;return v(),c("div",ie,[l("div",de,[l("div",re,[e[33]||(e[33]=l("div",{class:"section-title"},"上传图片",-1)),s(d,{class:"upload-block",drag:"","auto-upload":!1,"show-file-list":!1,accept:"image/*",limit:1,"on-change":j},{default:w(()=>[s(i,{class:"el-icon--upload"},{default:w(()=>[s(P(B))]),_:1}),e[14]||(e[14]=l("div",{class:"el-upload__text"},"拖拽或点击上传单张预览",-1))]),_:1}),e[34]||(e[34]=l("div",{class:"section-title"},"批量上传",-1)),s(d,{class:"upload-block",drag:"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:"image/*","on-change":(o,r)=>z(r)},{default:w(()=>[s(i,{class:"el-icon--upload"},{default:w(()=>[s(P(B))]),_:1}),e[15]||(e[15]=l("div",{class:"el-upload__text"},"拖拽或点击上传多张图片",-1))]),_:1},8,["on-change"]),e[35]||(e[35]=l("div",{class:"section-title"},"水印设置",-1)),l("div",ue,[l("div",me,[e[16]||(e[16]=l("div",{class:"label"},"文本",-1)),s(b,{modelValue:t.text,"onUpdate:modelValue":e[0]||(e[0]=o=>t.text=o),placeholder:"请输入水印文本"},null,8,["modelValue"])]),l("div",pe,[e[17]||(e[17]=l("div",{class:"label"},"模式",-1)),s(E,{modelValue:t.tile,"onUpdate:modelValue":e[1]||(e[1]=o=>t.tile=o),"active-text":"平铺","inactive-text":"单行"},null,8,["modelValue"])]),l("div",ce,[l("div",null,[e[18]||(e[18]=l("div",{class:"label"},"字号",-1)),s(n,{modelValue:t.fontSize,"onUpdate:modelValue":e[2]||(e[2]=o=>t.fontSize=o),min:12,max:100},null,8,["modelValue"])]),l("div",null,[e[19]||(e[19]=l("div",{class:"label"},"透明度",-1)),s(n,{modelValue:t.opacity,"onUpdate:modelValue":e[3]||(e[3]=o=>t.opacity=o),min:.05,max:1,step:.05},null,8,["modelValue"])])]),t.tile?(v(),c(R,{key:0},[l("div",ve,[l("div",null,[e[20]||(e[20]=l("div",{class:"label"},"间距 X",-1)),s(n,{modelValue:t.gapX,"onUpdate:modelValue":e[4]||(e[4]=o=>t.gapX=o),min:80,max:400},null,8,["modelValue"])]),l("div",null,[e[21]||(e[21]=l("div",{class:"label"},"间距 Y",-1)),s(n,{modelValue:t.gapY,"onUpdate:modelValue":e[5]||(e[5]=o=>t.gapY=o),min:80,max:400},null,8,["modelValue"])])]),l("div",fe,[l("div",null,[e[22]||(e[22]=l("div",{class:"label"},"角度",-1)),s(n,{modelValue:t.angle,"onUpdate:modelValue":e[6]||(e[6]=o=>t.angle=o),min:-90,max:90},null,8,["modelValue"])]),l("div",null,[e[23]||(e[23]=l("div",{class:"label"},"颜色",-1)),s(u,{modelValue:t.color,"onUpdate:modelValue":e[7]||(e[7]=o=>t.color=o),"show-alpha":""},null,8,["modelValue"])])])],64)):(v(),c(R,{key:1},[l("div",ge,[l("div",null,[e[24]||(e[24]=l("div",{class:"label"},"偏移 X",-1)),s(n,{modelValue:t.offsetX,"onUpdate:modelValue":e[8]||(e[8]=o=>t.offsetX=o),min:-400,max:400},null,8,["modelValue"])]),l("div",null,[e[25]||(e[25]=l("div",{class:"label"},"偏移 Y",-1)),s(n,{modelValue:t.offsetY,"onUpdate:modelValue":e[9]||(e[9]=o=>t.offsetY=o),min:-400,max:400},null,8,["modelValue"])])]),l("div",we,[l("div",null,[e[26]||(e[26]=l("div",{class:"label"},"颜色",-1)),s(u,{modelValue:t.color,"onUpdate:modelValue":e[10]||(e[10]=o=>t.color=o),"show-alpha":""},null,8,["modelValue"])]),l("div",null,[e[27]||(e[27]=l("div",{class:"label"},"角度（单行不旋转，保留设置用于切换平铺）",-1)),s(n,{modelValue:t.angle,"onUpdate:modelValue":e[11]||(e[11]=o=>t.angle=o),min:-90,max:90},null,8,["modelValue"])])])],64)),e[30]||(e[30]=l("div",{class:"section-title export-title"},"导出设置",-1)),l("div",Ve,[e[28]||(e[28]=l("div",{class:"label"},"缩放倍数（相对原图）",-1)),s(n,{modelValue:t.outputScale,"onUpdate:modelValue":e[12]||(e[12]=o=>t.outputScale=o),min:.1,max:2,step:.05},null,8,["modelValue"])]),l("div",xe,[s(E,{modelValue:t.limit1080p,"onUpdate:modelValue":e[13]||(e[13]=o=>t.limit1080p=o),"active-text":"限制在 1080p 以内","inactive-text":"不限制"},null,8,["modelValue"]),e[29]||(e[29]=l("div",{class:"hint"},"开启后会按最长边不超过 1080p（约 1920×1080）再乘以缩放倍数",-1))]),x.value?(v(),c("div",be," 导出分辨率："+L(x.value.w)+" × "+L(x.value.h),1)):O("",!0)]),l("div",Ue,[s(m,{type:"primary",loading:k.value,onClick:h},{default:w(()=>[...e[31]||(e[31]=[T("生成预览",-1)])]),_:1},8,["loading"]),s(m,{type:"success",loading:k.value,onClick:$},{default:w(()=>[...e[32]||(e[32]=[T("批量导出",-1)])]),_:1},8,["loading"])])]),l("div",ye,[e[36]||(e[36]=l("div",{class:"section-title"},"预览",-1)),l("div",_e,[f.value?(v(),c("div",ke,[l("img",{src:f.value,alt:"preview"},null,8,Ee)])):(v(),c("div",Le,"请上传图片并点击生成预览"))]),p.value.length>0?(v(),c("div",Se,[l("div",Xe,"已选文件（"+L(p.value.length)+"）",1),l("div",Ye,[(v(!0),c(R,null,K(p.value,o=>(v(),c("div",{key:o.url,class:"file-item"},[l("div",Re,L(o.name),1)]))),128))])])):O("",!0)])])])}}}),Pe=ne(Ie,[["__scopeId","data-v-2880b9cc"]]);export{Pe as default};
