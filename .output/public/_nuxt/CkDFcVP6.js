import{e as A,s as U,r as q,c as x,a as n,b as i,w,L as D,N as H,O as $,a0 as G,P as X,S as Z,X as J,W as K,o as h,Z as Q,i as P,a4 as Y,d as V,a9 as ee,aa as te,a2 as R}from"./BjynnqB9.js";import{_ as oe}from"./DlAUqK2U.js";const ae={class:"page",style:{padding:"16px"}},ne={class:"container",style:{"max-width":"1000px",margin:"0 auto"}},se={class:"controls",style:{display:"flex",gap:"12px","flex-wrap":"wrap"}},le={style:{display:"flex",gap:"16px","margin-top":"16px","flex-wrap":"wrap"}},ie={style:{flex:"1","min-width":"260px"}},re={style:{background:"#fff",padding:"12px","border-radius":"8px"}},de={key:0},ue={key:1},me={style:{"margin-top":"12px"}},pe={style:{"margin-top":"12px"}},ce={style:{"margin-top":"12px"}},ve={style:{flex:"1","min-width":"300px"}},we={style:{background:"#fff",padding:"12px","border-radius":"8px"}},ge={key:0,style:{"margin-bottom":"8px"}},fe=["src"],be=["src"],ye={style:{"margin-top":"8px"}},_e=A({__name:"index",setup(xe){const b=U("images"),g=U([]),L=U(!1),f=U(""),o=q({durationPerImage:2,transition:"pan",startTime:0,duration:5,fps:25,outputScale:1}),k=U(null),j=t=>{if(!t||!t.length)return;const e=t[0];e.type.startsWith("image/")?(b.value="images",g.value=Array.from(t).map(r=>({name:r.name,raw:r})),f.value=URL.createObjectURL(g.value[0].raw)):e.type.startsWith("video/")?(b.value="video",g.value=[{name:e.name,raw:e}],f.value=URL.createObjectURL(e)):R.error("仅支持图片或视频文件")},C=(t,e)=>{const r=(e||[]).map(s=>s.raw||s.file||s);j(r)},B=()=>{g.value=[],f.value&&URL.revokeObjectURL(f.value),f.value=""},M=async()=>{if(!g.value.length){R.warning("请先上传图片或视频");return}if(!k.value){R.error("Canvas 未准备好");return}L.value=!0;try{const t=k.value,e=t.getContext("2d");if(!e)throw new Error("Canvas not supported");let r=1080,s=1920;if(b.value==="images"){const d=await E(g.value[0].raw);r=d.width*o.outputScale,s=d.height*o.outputScale,t.width=r,t.height=s;const a=t.captureStream(o.fps),y=[];let u="video/webm";MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?u="video/webm;codecs=vp9":MediaRecorder.isTypeSupported("video/webm;codecs=vp8")&&(u="video/webm;codecs=vp8");const p=new MediaRecorder(a,{mimeType:u});p.ondataavailable=v=>{v.data&&v.data.size&&y.push(v.data)},p.start();for(const v of g.value){const l=await E(v.raw),m=Math.max(1,Math.round(o.durationPerImage*o.fps));for(let _=0;_<m;_++){e.clearRect(0,0,t.width,t.height);const N=_/m,S=o.transition==="zoom"?1+.1*N:1,O=S,W=(t.width-l.width*S)/2,z=(t.height-l.height*O)/2;e.save(),e.translate(W,z),e.scale(S,O),e.drawImage(l,0,0),e.restore(),await F()}}p.stop(),await T(p);const c=new Blob(y,{type:u});I(c,`dynamic-wallpaper-${Date.now()}.webm`),R.success("视频生成完成")}else{const d=g.value[0].raw,a=document.createElement("video");a.src=URL.createObjectURL(d),a.muted=!0,a.playsInline=!0,await new Promise(m=>a.addEventListener("loadedmetadata",m,{once:!0})),r=a.videoWidth*o.outputScale,s=a.videoHeight*o.outputScale,t.width=r,t.height=s;const y=t.captureStream(o.fps),u=[],p=MediaRecorder.isTypeSupported("video/webm;codecs=vp9")?"video/webm;codecs=vp9":"video/webm",c=new MediaRecorder(y,{mimeType:p});c.ondataavailable=m=>{m.data&&m.data.size&&u.push(m.data)},c.start(100),a.currentTime=o.startTime,a.play().catch(()=>{});const v=o.startTime+o.duration;await new Promise(m=>{const _=()=>{if(a.ended||a.currentTime>=v){a.pause(),m();return}e.clearRect(0,0,t.width,t.height),e.drawImage(a,0,0,t.width,t.height),requestAnimationFrame(_)};_()}),c.stop(),await T(c);const l=new Blob(u,{type:p});I(l,`dynamic-wallpaper-${Date.now()}.webm`),URL.revokeObjectURL(a.src),R.success("视频生成完成")}}catch(t){console.error(t),R.error("生成失败："+(t?.message||t))}finally{L.value=!1}},E=t=>new Promise((e,r)=>{const s=URL.createObjectURL(t),d=new Image;d.onload=()=>{URL.revokeObjectURL(s),e(d)},d.onerror=a=>{URL.revokeObjectURL(s),r(a)},d.src=s}),F=()=>new Promise(t=>requestAnimationFrame(()=>t(null))),T=t=>new Promise(e=>{t.addEventListener("stop",()=>e(),{once:!0})}),I=(t,e)=>{const r=URL.createObjectURL(t),s=document.createElement("a");s.href=r,s.download=e,s.click(),setTimeout(()=>URL.revokeObjectURL(r),200)};return(t,e)=>{const r=H,s=Q,d=$,a=G,y=X,u=ee,p=Z,c=J,v=K;return h(),x("div",ae,[n("div",ne,[n("div",se,[i(r,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),options:[{label:"图片序列",value:"images"},{label:"视频",value:"video"}]},null,8,["modelValue"]),i(d,{class:"upload",drag:"","auto-upload":!1,"show-file-list":!1,accept:"image/*,video/*",multiple:"","on-change":C},{default:w(()=>[i(s,null,{default:w(()=>[i(P(Y))]),_:1}),e[7]||(e[7]=n("div",null,"拖拽或点击上传图片序列或视频",-1))]),_:1}),i(a,{type:"warning",onClick:B},{default:w(()=>[...e[8]||(e[8]=[V("清空",-1)])]),_:1})]),n("div",le,[n("div",ie,[n("div",re,[e[18]||(e[18]=n("div",{style:{"font-weight":"600","margin-bottom":"8px"}},"设置",-1)),b.value==="images"?(h(),x("div",de,[e[12]||(e[12]=n("div",{style:{"margin-bottom":"8px"}},"每张时长（秒）",-1)),i(y,{modelValue:o.durationPerImage,"onUpdate:modelValue":e[1]||(e[1]=l=>o.durationPerImage=l),min:.5,max:10,step:.1},null,8,["modelValue"]),e[13]||(e[13]=n("div",{style:{"margin-top":"8px"}},"过渡",-1)),i(p,{modelValue:o.transition,"onUpdate:modelValue":e[2]||(e[2]=l=>o.transition=l)},{default:w(()=>[i(u,{label:"pan"},{default:w(()=>[...e[9]||(e[9]=[V("平移",-1)])]),_:1}),i(u,{label:"zoom"},{default:w(()=>[...e[10]||(e[10]=[V("缩放",-1)])]),_:1}),i(u,{label:"none"},{default:w(()=>[...e[11]||(e[11]=[V("无",-1)])]),_:1})]),_:1},8,["modelValue"])])):(h(),x("div",ue,[e[14]||(e[14]=n("div",{style:{"margin-bottom":"8px"}},"开始时间（秒）",-1)),i(c,{modelValue:o.startTime,"onUpdate:modelValue":e[3]||(e[3]=l=>o.startTime=l),min:0,step:.5},null,8,["modelValue"]),e[15]||(e[15]=n("div",{style:{"margin-top":"8px","margin-bottom":"8px"}},"时长（秒）",-1)),i(c,{modelValue:o.duration,"onUpdate:modelValue":e[4]||(e[4]=l=>o.duration=l),min:1,step:.5},null,8,["modelValue"])])),n("div",me,[e[16]||(e[16]=n("div",null,"帧率 (FPS)",-1)),i(y,{modelValue:o.fps,"onUpdate:modelValue":e[5]||(e[5]=l=>o.fps=l),min:10,max:30,step:1},null,8,["modelValue"])]),n("div",pe,[i(v,{modelValue:o.outputScale,"onUpdate:modelValue":e[6]||(e[6]=l=>o.outputScale=l),"active-text":"高清","inactive-text":"原始"},null,8,["modelValue"])]),n("div",ce,[i(a,{type:"primary",loading:L.value,onClick:M},{default:w(()=>[i(s,null,{default:w(()=>[i(P(te))]),_:1}),e[17]||(e[17]=V(" 生成动态壁纸视频 ",-1))]),_:1},8,["loading"])])])]),n("div",ve,[n("div",we,[e[19]||(e[19]=n("div",{style:{"font-weight":"600","margin-bottom":"8px"}},"预览",-1)),f.value?(h(),x("div",ge,[b.value==="video"?(h(),x("video",{key:0,src:f.value,controls:"",playsinline:"","webkit-playsinline":"",style:{width:"100%","border-radius":"8px"}},null,8,fe)):(h(),x("img",{key:1,src:f.value,style:{width:"100%","border-radius":"8px"}},null,8,be))])):D("",!0),n("div",ye,[n("canvas",{ref_key:"canvasRef",ref:k,style:{width:"100%",background:"#000","border-radius":"8px"}},null,512)])])])])])])}}}),Ue=oe(_e,[["__scopeId","data-v-b4a46366"]]);export{Ue as default};
